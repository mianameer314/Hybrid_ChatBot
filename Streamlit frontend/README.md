# ðŸ¤– AI Chatbot with Hybrid Backend + Streamlit Frontend

This document summarizes the **development journey** of our chatbot project, including **backend APIs, frontend (Streamlit) app, caching, database memory, and agent features**.

---

## ðŸ“Œ 1. Project Overview

We built an **AI Chatbot system** that integrates:

* **Streamlit Frontend** â†’ For user interaction.
* **FastAPI Backend** â†’ Handles history, Redis caching, and API requests.
* **Hybrid AI Providers**:
  * **Offline rule-based answers**.
  * **Google Gemini API**.
  * **HuggingFace Local Model** (distilgpt2).
  * **LangChain Agent with PostgreSQL memory**.
* **Redis Integration** â†’ For fast chat history cache.
* **PostgreSQL** â†’ For persistent message history.

---

## ðŸ“Œ 2. Architecture

```
[ User ]  
   â†“ (chat input)  
[ Streamlit Frontend ]  
   â†“ REST calls  
[ FastAPI Backend ]  
   â”œâ”€â”€ PostgreSQL (DB history)  
   â”œâ”€â”€ Redis (cache)  
   â””â”€â”€ Providers (Gemini / HF / Agent / Offline)
```

---

## ðŸ“Œ 3. Streamlit Frontend (`app.py`)

We designed a modern **chat UI** with:

* **Session state** â†’ Stores unique session IDs.
* **Sidebar settings** â†’ Choose chatbot mode & manage Redis.
* **Chat display** â†’ User messages (blue), bot messages (light blue).
* **Chat input** â†’ Sends messages to backend.

### Features:

1. **Mode Selection**
   * `Hybrid (Gemini â†’ HF)`
   * `Gemini only`
   * `HuggingFace only`
   * `Agent (LangChain)`

2. **Demo Mode**
   * Works **offline** with only predefined rules.

3. **Redis Tools (Sidebar)**
   * âœ… **Check Redis Connection**
   * ðŸ“œ **View Cached History**
   * ðŸ—‘ **Clear Cached Session**
   * All mapped correctly to backend routes (`/chat/cache/...`).

4. **History Management**
   * Loads DB history from backend.
   * Saves each user/bot message into PostgreSQL.
   * Syncs with Redis cache for fast retrieval.

---

## ðŸ“Œ 4. Backend API (FastAPI)

We created endpoints under `/chat`:

### ðŸ”¹ History Management
* `GET /chat/history/{session_id}` â†’ Get DB-stored history.
* `POST /chat/send` â†’ Save new message.
* `POST /chat/clear/{session_id}` â†’ Clear DB history.

---

## ðŸ“Œ 5. Chatbot Logic

When user sends a message:

1. **Offline Answer** (predefined rules).
2. If no match â†’ **Gemini Provider**.
3. If Gemini fails â†’ **HF Provider (distilgpt2)**.
4. If still no reply â†’ **Fallback message**.
5. **Agent Mode** (LangChain + Postgres memory) can be chosen separately.

### ðŸ’¡ Sentiment Analysis
* Before saving user message, we run `analyze(user_message)` to detect sentiment.

---

## ðŸ“Œ 6. Providers

### ðŸ”¹ Offline Rules
* Predefined FAQ-like responses.
* Example: `"hi"` â†’ `"Hello! How can I help?"`.

### ðŸ”¹ Gemini Provider
* Calls Google Gemini API (streaming).
* Uses **system prompt**: `"Be concise, friendly, and helpful."`.

### ðŸ”¹ HF Local Provider
* Runs a lightweight model (`distilgpt2`) locally.

### ðŸ”¹ Agent (LangChain)
* Custom **LangChain Agent** with **Postgres memory**.
* Looks at last 10 messages to respond.

---

## ðŸ“Œ 7. Redis & DB Integration

* **PostgreSQL** keeps full history (long-term memory).
* **Redis** caches recent messages (short-term memory).
* Users can **view/clear cached history** from sidebar.

---

## ðŸ“Œ 8. Final User Flow

1. User opens Streamlit app.
2. Chooses mode in sidebar.
3. Sends a message.
4. Bot response is generated by:
   * Rules â†’ Gemini â†’ HF â†’ Fallback (based on mode).
   * Or handled entirely by **Agent (LangChain)**.
5. Message history:
   * Saved in **Postgres**.
   * Cached in **Redis**.
6. User can manage history/cache from sidebar.

---

## ðŸ“Œ 9. Example

### User Input:
```
Hi bot! Can you help me?
```

### Bot Response:
```
Hello! Iâ€™m your hybrid chatbot ðŸ¤–
I can answer using rules, Gemini, HuggingFace, or even Agent mode with memory.
Which do you want to try?
```

---

## ðŸ“Œ 10. Key Features Recap

âœ… Hybrid AI workflow (rules â†’ Gemini â†’ HuggingFace â†’ Agent).  
âœ… Streamlit chat UI with styled messages.  
âœ… Session-based memory using PostgreSQL.  
âœ… Redis integration for fast cache + history tools.  
âœ… LangChain Agent with memory.  
âœ… Sentiment analysis on user messages.  
âœ… Sidebar controls for modes & Redis management.  

---

âœ¨ This makes our chatbot:

* **Fast** (Redis cache),  
* **Persistent** (DB history),  
* **Flexible** (multiple AI providers),  
* **Smart** (Agent + LangChain),  
* **User-friendly** (Streamlit UI).  
